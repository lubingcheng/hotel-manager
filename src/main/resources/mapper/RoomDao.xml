<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lhl.hotelmanager.dao.RoomDao">

    <!--<resultMap type="com.lhl.hotelmanager.entity.Room" id="AllRoomMessage">
        <id column="id" property="id"/>
        <result column="code" property="code"/>
        <result column="floor" property="floor"/>
        <result column="type" property="type"/>
        <result column="typeName" property="typeName"/>
        <result column="prise" property="prise"/>
        <association property="roomStatus" javaType="com.lhl.hotelmanager.entity.RoomStatus">
            <result column="status" property="status"/>
        </association>
    </resultMap>-->

    <select id="getAllRoomByStatus" parameterType="int" resultType="com.lhl.hotelmanager.entity.RoomAll">
        SELECT r.*,s.`status`,s.orderCode  from room r LEFT JOIN room_status s on r.`code` = s.`roomCode` where s.`status` = #{status}  order by r.`code`
    </select>

    <select id="getAllRoomWithOutStatus" parameterType="int" resultType="com.lhl.hotelmanager.entity.RoomAll">
        SELECT r.*,s.`status` ,s.orderCode from room r LEFT JOIN room_status s on r.`code` = s.`roomCode` where s.`status` != #{status}  order by r.`code`
    </select>

    <select id="getAllRoom" resultType="com.lhl.hotelmanager.entity.RoomAll">
        SELECT r.*,s.`status` from room r LEFT JOIN room_status s on r.`code` = s.`roomCode`  order by r.`code`
    </select>

    <select id="getAllFloor" resultType="com.lhl.hotelmanager.entity.Room">
        select floor from room group by floor;
    </select>

    <insert id="insertReservation" parameterType="com.lhl.hotelmanager.entity.Reservation" useGeneratedKeys="true"
            keyProperty="id">
      INSERT INTO reservation
      (
          id,`name`,phone,comeTime,`time`,roomCode,roomType,roomTypeName,roomPrise,inTime,outTime,roomFloor,`day`
      )
      VALUES (
          #{id},
          #{name},
          #{phone},
          #{comeTime},
          #{time},
          #{roomCode},
          #{roomType},
          #{roomTypeName},
          #{roomPrise},
          #{inTime},
          #{outTime},
          #{roomFloor},
          #{day}
      )
   </insert>

    <select id="selectRoomStatusByCode" parameterType="int" resultType="com.lhl.hotelmanager.entity.RoomStatus">
        select *  from room_status where roomCode = #{code};
    </select>

    <update id="updateRoomStatus">
        update room_status set status=#{status} ,orderCode = #{orderCode} where roomCode=#{code};
    </update>

    <update id="updateReservationStatus">
        update reservation set status = 1 where id = #{id};
    </update>

    <insert id="insertInRoom" parameterType="com.lhl.hotelmanager.entity.InRoom" useGeneratedKeys="true"
            keyProperty="id">
      INSERT INTO inRoom
      (
          id,roomCode,roomType,roomTypeName,roomFloor,roomPrise,`name`,idCard,phone,`time`,outTime,`status`,`day`,personNum
      )
      VALUES (
          #{id},
          #{roomCode},
          #{roomType},
          #{roomTypeName},
          #{roomFloor},
          #{roomPrise},
          #{name},
          #{idCard},
          #{phone},
          #{time},
          #{outTime},
          #{status},
          #{day},
          #{personNum}
      )
   </insert>

    <select id="getReservationById" parameterType="int" resultType="com.lhl.hotelmanager.entity.Reservation">
        select * from reservation where id = #{id};
    </select>

    <select id="getAllReservation" resultType="com.lhl.hotelmanager.entity.Reservation">
        select * from reservation ;
    </select>
</mapper>